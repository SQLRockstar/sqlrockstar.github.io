---
layout: post
title: You Can’t Marry Your Database, But You Can Have Relations
date: '2021-02-01 18:15:29 +0000'
categories:
- Data Analytics
- Database Design
- MSSQL
- SQL MVP
- SQL Server Performance
tags:
- analytics
- database
---

<p>There’s something you should know about relational databases.</p>   <p>They were designed to store data efficiently, protecting the quality of the data written and stored to disk. I’ve written before about <a href="https://thomaslarock.com/2018/07/databases-101/" target="_blank" rel="noreferrer noopener">relational engines favoring data quality and integrity</a>, and how relational databases were not designed for the <strong><em>reading</em></strong> of data.</p>   <p>Of course, if you are going through the trouble of writing the data into a relational database, it makes sense that you would want to retrieve the data at some point. Otherwise, why go through the exercise of storing the data inside the database?</p>   <p>The trouble with reading data from a relational database is due to the data not being stored in a format that is friendly for viewing, reading, or retrieving. That’s why we have data professionals, like me, to help you write queries that return the correct data, in the correct format, for you to analyze.</p>   <p>I’m here today to tell you&nbsp;<em>we’ve been doing data wrong the whole damn time</em>.</p>   <p>Let me show you what I mean.</p>   <h2 id="h-traditional-data-flow-patterns">Traditional Data Flow Patterns</h2>   <p>Here’s what companies do, every day:</p>   <p>Step 1 – Identify useful data</p>   <p>Step 2 – Import that data into a database</p>   <p>Step 3 – Analyze the data</p>   <p>Step 4 – Export the data into dashboards</p>   <p>Step 5 – Profit (maybe)</p>   <p>The trouble with this process is Step 3, the analyzing of the data. Relational databases were not designed for analytical processing. <strong>Relational databases do not store data in a way that is readable, or friendly, for human analysis</strong>.</p>   <p>That’s not to say you can’t do analytics inside of a relational database. What I am saying is that it could be better for you not to spin the CPU cycles there, and instead do the analytics somewhere else.</p>   <p>For example, data warehouses help with data storage, retrieval, and analytics. But even a data warehouse can fall short when it comes to the use of unstructured data sources. As a result, we’ve spent decades building ETL processes to curate, collate, consolidate, and consume data.</p>   <p>And we’ve been doing it wrong.</p>   <h2>Data Mining for the Data Expert</h2>   <p>So, we understand that people find data, store it, and try to use it later. They are engaging in the process of data mining, hoping to find gold in the form of insights, leading to better business decisions.</p>   <p>But as I mentioned before, the data isn’t in a readable format. Let’s look at an example.</p>   <p>Following the common data flow pattern, I found some useful data at NFL Savant <a href="https://nflsavant.com/about.php">https://nflsavant.com/about.php</a>, and imported the data into a SQL Server database:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://thomaslarock.com/wp-content/uploads/2021/02/image-8-600x417.png" alt="" class="wp-image-20578"/></figure></div>   <p>It looks like any other table in a relational database. In this case, it is a table containing time series data pertaining to play by play records for the 2018 NFL season. Each row represents an entity (a play at a point in time of an NFL game), and the columns represent attributes of the play (down, distance, yards to go, etc.)</p>   <p>Nothing out of place here, this is how data is written to a relational database. In an orderly fashion. As a DBA, I love this type of orderly storage. It’s efficient, and efficient is good.</p>   <p>As a data analyst, I’m not a fan. At least, not yet. I have a bunch of data, but what I want are some answers. So, it’s up to me to ask some questions of the data, find some answers, and use that to help make better business decisions.</p>   <p>For this data, here’s an example of a simple question: What are the average yards to go for NFL teams in 2018? I can get that answer with some simple T-SQL:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://thomaslarock.com/wp-content/uploads/2021/02/image-9-378x600.png" alt="" class="wp-image-20579"/></figure></div>   <p>This is great! I was able to take my data, ask a question, and get an answer. What could be better, right?</p>   <p>Of course, now I have&nbsp;<strong>more</strong>&nbsp;questions about my data. And here’s the first issue you will discover when trying to analyze data stored in a traditional relational database.</p>   <p><strong><em>T-SQL is excellent at answering one question at a time, but not as great when you need more than one question answered.</em></strong></p>   <p>So, if we have more questions, we will need to write more queries.</p>   <p>Here’s a good follow-up question that we might want to be answered: Can we examine this data broken down by each quarter?</p>   <p>Fortunately, the answer is yes, because T-SQL comes with a bunch of statements and functions that will help. In this case, I am going to use the PIVOT operator, as follows:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://thomaslarock.com/wp-content/uploads/2021/02/image-10-491x600.png" alt="" class="wp-image-20580"/></figure></div>   <p>Easy, right?</p>   <p>No, not easy.</p>   <p>And not readable, either. What’s with that row saying NULL? Why do I not have a result for some teams in that last column?</p>   <p>As it turns out, you need a lot of experience writing T-SQL to get to that query. And you need more experience understanding the result set, too.&nbsp;<strong>You don’t start on Day 0 as a data professional writing PIVOT queries against a SQL Server database</strong>.</p>   <p>Here’s the good news: You don’t need to write PIVOT queries, ever.</p>   <h2>Data Mining for the Masses</h2>   <p>The data import from NFL Savant was in the form of a CSV file, which I then imported into my database. Because that’s how ETL is done (see above for the common data flow process).</p>   <p>What if…now hear me out…we skipped step 2? Forget about doing the import process. Instead, let’s open that CSV file in Excel.</p>   <p>Here’s what it would look like:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://thomaslarock.com/wp-content/uploads/2021/02/image-11-600x287.png" alt="" class="wp-image-20581"/></figure></div>   <p>Back to our football questions. We’ve seen examples in T-SQL, let’s look at how to do this in Excel using a Pivot table.</p>   <p><em>I click on one cell in Excel, insert a pivot table, drag the offense teams as a row, and the downs to go as a value, change it to an average, and we are done. Have a look:</em></p>   <div class="wp-block-image"><figure class="aligncenter size-full"><img src="https://thomaslarock.com/wp-content/uploads/2021/02/PIVOT.gif" alt="" class="wp-image-20587"/></figure></div>   <p>It took but a few seconds to get this magic to happen. Here’s what I want you to know:</p>   <p>1. No T-SQL is necessary. None. Not one line of code.</p>   <p>2. I have the entire table as a pivot table, allowing me to answer more questions WITHOUT needing to write more T-SQL.</p>   <p>3. There is no code. None.</p>   <p>Let’s say that I want to know the yards to go broken down by quarter. With T-SQL, I would need to write a new query. With the pivot table, it’s a simple drag and drop, like this:</p>   <div class="wp-block-image"><figure class="aligncenter size-full"><img src="https://thomaslarock.com/wp-content/uploads/2021/02/PIVOT2.gif" alt="" class="wp-image-20588"/></figure></div>   <p></p>   <p>Fin.</p>   <p>There is no need to rewrite code to get this result. Because there is no code, it’s drag and drop, and then I have my answer.</p>   <p>And that’s why&nbsp;<strong><em>I believe the inclusion of pivot table inside Excel is the greatest advancement in the 21<sup>st</sup>&nbsp;century for data professionals.</em></strong></p>   <p>Fight me.</p>   <h2>Summary</h2>   <p>I did not come here to bury relational databases. I came here to help you understand relational databases may not be the right place to do analytical processing.</p>   <p>When it comes to curating and consuming data, I have three simple rules for you to follow:</p>   <p>Rule #1 –&nbsp;<strong>Only collect data that you need</strong>. Don’t collect data “just in case you may need it later.” The data you collect must be relevant for your needs right now.</p>   <p>Rule #2 –&nbsp;<strong>Understand that all data is dirty</strong>. You could build a perfect analytical solution but based on inaccurate data. Know the risks involved in making business decisions based on dirty data.</p>   <p>Rule #3 –&nbsp;<strong>Before you collect any data, consider where the data will be processed</strong>. Don’t just assume that your database will do everything you need. Take time to list out all the available tools and systems at your disposal. The result may be a simpler solution than first imagined.</p>   <p>I wrote this post to help you understand Rule #3. Analysis of NFL play by play data is best done in a tool such as Excel, or PowerBI, and not (necessarily) inside of SQL Server.</p>   <p>SQL Server is a robust relational database engine, containing integrations with data science-y stuff such as R and Python. Just because you <strong>could</strong> do your analysis inside the SQL Server engine doesn’t mean you should.</p>   <p><em>This post <a href="https://powerpivotpro.com/2019/03/you-cant-marry-your-database-but-you-can-have-relations/" target="_blank" rel="noreferrer noopener">originally appeared on PowerPivotPro</a> and I was reminded about its existence while talking with Rob Collie during our <a href="https://powerpivotpro.com/rawdatapodcast/" target="_blank" rel="noreferrer noopener">Raw Data podcast</a>. I asked Rob if I could repost here. He said yes. True story.</em></p>