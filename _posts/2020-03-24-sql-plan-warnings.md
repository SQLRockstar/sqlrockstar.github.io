---
layout: post
title: SQL Plan Warnings
date: '2020-03-24 12:39:07 +0000'
categories:
- AWS
- Azure
- Database Design
- MSSQL
- SQL Azure
- SQL MVP
- SQL Server Performance
tags:
- performance tuning
- plan warnings
- sql server
---

<p>There are many methods available for optimizing the performance of SQL Server. One method in particular is examining your plan cache, looking for query plan warnings. Plan warnings include implicit conversions, key or RID lookups, and missing indexes to name a few. Each of these warnings is the optimizer giving you the opportunity to take action and improve performance. Unfortunately, these plan warnings are buried inside the plan cache, and not many people want to spend time mining their plan cache. That sounds like work.</p>   <p>That's why last year our company (<a rel="noreferrer noopener" aria-label="SolarWinds (opens in a new tab)" href="https://www.solarwinds.com/" target="_blank">SolarWinds</a>) launched a free tool called <a href="https://www.solarwinds.com/free-tools/sql-plan-warnings" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">SQL Plan Warnings</a>. Often mining the plan cache involves custom scripts and forcing you to work with text output only. We wanted to make things easier by providing a graphical interface. A GUI will allow for the user to have basic application functionality. Things like connecting to more than one instance at a time, or filtering results with a few clicks. </p>   <p>Let me give a quick tour of SQL Plan Warnings. </p>   <h2>Connect to an instance</h2>   <p>The first thing noteworthy here is how SQL Plan Warnings supports connecting to a variety of flavors of SQL Server. There's the Earthed version, Azure QL Database, Azure SQL Database Manage Instance, and Amazon RDS for SQL Server as shown here:</p>   <div class="wp-block-image"><figure class="aligncenter size-large is-resized"><img src="https://i1.wp.com/thomaslarock.com/wp-content/uploads/2020/03/image.png?fit=600%2C543&amp;ssl=1" alt="" class="wp-image-19776" width="450" height="407"/></figure></div>   <p>From there you fill in your connection details. The login you choose will need either the VIEW SERVER STATE or SELECT permission for the following DMVs: <a rel="noreferrer noopener" aria-label="dm_exec_query_stats (opens in a new tab)" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-stats-transact-sql?view=sql-server-ver15" target="_blank">dm_exec_query_stats</a>, <a rel="noreferrer noopener" aria-label="dm_exec_sql_text (opens in a new tab)" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-sql-text-transact-sql?view=sql-server-ver15" target="_blank">dm_exec_sql_text</a>, and <a rel="noreferrer noopener" aria-label="dm_exec_text_query_plan (opens in a new tab)" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-text-query-plan-transact-sql?view=sql-server-ver15" target="_blank">dm_exec_text_query_plan</a>. I've provided links to the Microsoft docs for each, so you can review the permissions defined there. </p>   <p>Being able to easily connect to instance of SQL Server, no matter where they are located, is a must-have these days.</p>   <h2>SQL Plan Warnings Settings</h2>   <p>After you connect to your instance, SQL Plan Warnings will return the top 100 plans, with a default sort by CPU time. However, it is possible after connecting you may see no results. This is likely due to the default settings for SQL Plan Warnings. You get to the settings by clicking on the gear icon in the upper-right corner. Here is what the default settings look like:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://i2.wp.com/thomaslarock.com/wp-content/uploads/2020/03/image-1.png?fit=467%2C600&amp;ssl=1" alt="" class="wp-image-19777"/></figure></div>   <p>If you are not seeing any results, change the default settings and refresh plan analysis. For me, I simply made the change to filter by executions, with 1 as the minimum. This returns a lot of noise, so you need to discover what makes the most sense for your particular instance. </p>   <p>Please note these default settings apply to each connected instance. Think of these settings as the highest level filter for all your connected sources. It may be possible you spend time adjusting these settings frequently, depending on the instance, the workload, and your query tuning goals.</p>   <h2>Reviewing the SQL Plan Warnings Results</h2>   <p>After plan analysis is complete, you will see a list of warnings found. It should look like this:</p>   <div class="wp-block-image"><figure class="aligncenter size-large is-resized"><img src="https://thomaslarock.com/wp-content/uploads/2020/03/image-2.png" alt="" class="wp-image-19778" width="250" height="259"/></figure></div>   <p>Note that a plan can have multiple warnings. So this list could be generated by one or more plans found. </p>   <p>From here we are able to filter on a specific warning type with a simple click. This allows us to narrow our focus. Perhaps today we want to focus on Key and RID lookups. We select that filter, then open the plan:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://i2.wp.com/thomaslarock.com/wp-content/uploads/2020/03/image-3.png?fit=600%2C349&amp;ssl=1" alt="" class="wp-image-19779"/></figure></div>   <p>From here we can zoom and scroll, and view the node that has the lookup warning:</p>   <div class="wp-block-image"><figure class="aligncenter size-large"><img src="https://i2.wp.com/thomaslarock.com/wp-content/uploads/2020/03/image-4.png?fit=600%2C349&amp;ssl=1" alt="" class="wp-image-19780"/></figure></div>   <p>If we select the node a properties dialogue that opens to the right. We also see other warnings are included in this plan, if we want or need to investigate those at this time. We also have the ability to download the plan, if desired.</p>   <h2>Summary</h2>   <p>The SQL Plan Warnings tool is easy to use and allows for you to be proactive in optimizing your environment. The use of a GUI allows for quick filtering at the plan cache level as well as plan warnings themselves. This allows you to focus on the plan warnings with the most impact.</p>   <p>One thing to note is the size of the plan cache you choose to analyze. Instances with larger plan cache sizes (1GB or greater) may require a larger number of plans to parse for warnings. </p>   <p>You can download the SQL Plan Warnings tool <a href="https://www.solarwinds.com/free-tools/sql-plan-warnings" target="_blank" rel="noreferrer noopener" aria-label="here (opens in a new tab)">here</a>. </p>